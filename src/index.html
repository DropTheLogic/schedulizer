<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<title>Staff Schedule and Task Organizer</title>

	<link href="https://fonts.googleapis.com/css?family=Lustria|Open+Sans"
		rel="stylesheet">
	<link rel="stylesheet" href="css/bootstrap.min.css" type="text/css" />
	<link rel="stylesheet" href="css/main.css" type="text/css" />
</head>

<body>

	<header>
		<h1>Schedulizer</h1>
		<div class="cell">Click things to edit, click away to save</div>
	</header>

	<section id="schedules" class="container" data-bind="foreach: schedules">
		<!-- Schedule Name -->
		<h3><span data-bind="visible: !$data.editingName(),
					   text: $data.name,
					   click: $data.editName"></span>
			<span><input data-bind="visible: $data.editingName,
							  value: $data.name,
							  event: {keydown: $root.clearFocus},
							  hasFocus: $data.editingName" /></span></h3>

		<!-- Table -->
		<table class="table table-striped table-bordered table-hover
			table-responsive table-condensed">

			<thead>
				<tr class="heading">
					<td class="cell-title">Name</td>
					<td class="cell-title">Job</td>
					<!-- ko {foreach: $data.periodNames} -->
					<td data-bind="text: $data"></td>
					<!-- /ko -->
					<td class="cell-title center-text">Total Hours</td>
				</tr>
			</thead>

			<tbody>
				<!-- ko {foreach: workers} -->
				<tr>
					<!-- Worker Name -->
					<td class="cell">
						<div data-bind="visible: !editingName(), text: name,
										click: editName"></div>
						<input data-bind="visible: editingName, value: name,
										  event: {keydown: $root.clearFocus},
										  hasFocus: editingName" />
					</td>

					<!-- Worker Job -->
					<td class="cell">
						<div data-bind="visible: !editingJob(), text: job,
										click: editJob"></div>
						<input data-bind="visible: editingJob, value: job,
										  event: {keydown: $root.clearFocus},
										  hasFocus: editingJob" />
					</td>

					<!-- ko { foreach: hours} -->
					<td class="cell">
					<span data-bind="visible: !$data.off()">

						<!-- ko { with: $data.in} -->
						<span data-bind="
							visible: !$data.editingHour(),
							text: $data.hour,
							click: function() { $data.editHour(); }"></span>
						<select data-bind="
							visible: $data.editingHour,
							options: hours, value: $data.hour,
							hasFocus: $data.editingHour"></select>
						<span>:</span>
						<span data-bind="
							visible: !$data.editingMin(),
							text: ('0' + $data.min()).slice(-2),
							click: function() { $data.editMin(); }"></span>
						<select data-bind="
							visible: $data.editingMin,
							options: minutes, value: $data.min,
							hasFocus: $data.editingMin"></select>
						<span data-bind="
							visible: !$data.editingAM(),
							text: $data.ampm,
							click: function() { $data.editAM(); }"></span>
						<select data-bind="
							visible: $data.editingAM,
							options: am, value: $data.ampm,
							hasFocus: $data.editingAM"></select>
						<!-- /ko -->

						<span class="spacer"> - </span>

						<!-- ko { with: $data.out } -->
						<span data-bind="
							visible: !$data.editingHour(),
							text: $data.hour,
							click: function() { $data.editHour(); }"></span>
						<select data-bind="
							visible: $data.editingHour,
							options: hours, value: $data.hour,
							hasFocus: $data.editingHour"></select>
						<span>:</span>
						<span data-bind="
							visible: !$data.editingMin(),
							text: ('0' + $data.min()).slice(-2),
							click: function() { $data.editMin(); }"></span>
						<select data-bind="
							visible: $data.editingMin,
							options: minutes, value: $data.min,
							hasFocus: $data.editingMin"></select>
						<span data-bind="
							visible: !$data.editingAM(),
							text: $data.ampm,
							click: function() { $data.editAM(); }"></span>
						<select data-bind="
							visible: $data.editingAM,
							options: am, value: $data.ampm,
							hasFocus: $data.editingAM"></select>
						<!-- /ko -->
					</span>

					<!-- Display 'Off' Text -->
					<span data-bind="visible: $data.off" class="off"></span>

					<!-- Set-off Button -->
					<span data-bind="click: $data.toggleOff"
						class="set-off">✖</span>

					</td>
					<!-- /ko -->

					<!-- Total Hours on Schedule for Worker -->
					<td class="cell center-text"
						data-bind="text: totalTime().toFixed(2);">
					</td>

					<!-- Buttons to manage Worker -->
					<td class="button-cell manage-worker">

						<!-- Move worker up -->
						<button title="Move This Worker Up One"
							class="btn btn-xs btn-info button-worker"
							data-bind="click: function(){
								$parent.moveWorker($rawData, $index, -1); }" >
							↑↑</button>

						<!-- Move worker down -->
						<button title="Move This Worker Down One"
							class="btn btn-xs btn-info button-worker"
							data-bind="click: function(){
								$parent.moveWorker($rawData, $index, 1); }" >
							↓↓</button>

						<!-- Insert new worker above -->
						<button title="Add Worker Before"
							class="btn btn-xs btn-primary button-worker"
							data-bind="click: function() {
								$parent.addWorker($index, 0); }">
							+↑</button>

						<!-- Insert new worker below -->
						<button title="Add Worker After"
							class="btn btn-xs btn-primary button-worker"
							data-bind="click: function() {
								$parent.addWorker($index, 1); }">
							+↓</button>

						<!-- Delete worker -->
						<button title="Delete Worker"
							class="btn btn-xs btn-danger button-worker"
							data-bind="click: function() {
								$parent.deleteWorker($index); }">
							x</button>
					</td>
				</tr>
				<!-- /ko -->

				<!-- Button to add new worker to schedule -->
				<tr><td class="button-cell add-worker">
					<button data-bind="click: addWorker" class="cell btn btn-xs btn-primary">
						+ Add Worker
					</button>
				</td></tr>

			</tbody>

			<!-- Footer for totals -->
			<tfoot>
				<tr class="heading">
					<td class="cell-title">Total in range:</td>
					<td class="cell-title">Of Job Type:</td>
				</tr>
				<!-- ko { foreach: queries } -->
				<tr>
					<!-- Query time selector -->
					<td class="cell">
						<!-- ko { with: $data.target.start } -->
						<span data-bind="
							visible: !$data.editingHour(), text: $data.hour,
							click: function() { $data.editHour(); }"></span>
						<select data-bind="
							visible: $data.editingHour,
							options: hours, value: $data.hour,
							hasFocus: $data.editingHour"></select>
						<span>:</span>
						<span data-bind="
							visible: !$data.editingMin(),
							text: ('0' + $data.min()).slice(-2),
							click: function() { $data.editMin(); }"></span>
						<select data-bind="
							visible: $data.editingMin,
							options: minutes, value: $data.min,
							hasFocus: $data.editingMin"></select>
						<span data-bind="
							visible: !$data.editingAM(), text: $data.ampm,
							click: function() { $data.editAM(); }"></span>
						<select data-bind="
							visible: $data.editingAM,
							options: am, value: $data.ampm,
							hasFocus: $data.editingAM"></select>
						<!-- /ko -->

						<span class="spacer">to</span>

						<!-- ko { with: $data.target.end } -->
						<span data-bind="
							visible: !$data.editingHour(), text: $data.hour,
							click: function() { $data.editHour(); }"></span>
						<select data-bind="
							visible: $data.editingHour,
							options: hours, value: $data.hour,
							hasFocus: $data.editingHour"></select>
						<span>:</span>
						<span data-bind="
							visible: !$data.editingMin(),
							text: ('0' + $data.min()).slice(-2),
							click: function() { $data.editMin(); }"></span>
						<select data-bind="
							visible: $data.editingMin,
							options: minutes, value: $data.min,
							hasFocus: $data.editingMin"></select>
						<span data-bind="
							visible: !$data.editingAM(), text: $data.ampm,
							click: function() { $data.editAM(); }"></span>
						<select data-bind="
							visible: $data.editingAM,
							options: am, value: $data.ampm,
							hasFocus: $data.editingAM"></select>
						<!-- /ko -->
					</td>

					<!-- Job selector, to match query against -->
					<td class="cell">
						<select data-bind="options: $parent.jobs,
							value: $data.target.job"></select>
					</td>

					<!-- ko { foreach: $data.tallies } -->
					<td class="cell center-text" data-bind="text: $data"></td>
					<!-- /ko -->

					<!-- Button to delete query from queries array -->
					<td class="button-cell delete">
						<button data-bind="click: $parent.deleteQuery"
							class="cell btn btn-xs btn-danger">✖ Delete Query
						</button>
					</td>
				</tr>
				<!-- /ko -->

				<!-- Button to add new total query -->
				<tr><td class="button-cell add-query">
					<button data-bind="click: addQuery"
						class="cell btn btn-xs btn-info">
						+ Add Total Query
					</button>
				</td></tr>

				<!-- Buttons for schedule management -->
				<tr>
					<!-- Add new schedule -->
					<td class="button-cell schedule-manage">
						<button class="cell btn btn-sm btn-primary"
							data-bind="click: function() {
								$root.newSchedule($data, $index); }">
							+ New Schedule
						</button>
					</td>

					<!-- Save schedule button -->
					<td class="button-cell schedule-manage">
						<button class="cell btn btn-sm btn-success"
							data-bind="click: function() {
								$root.saveSchedule($data); }">
							Save Schedule
						</button>
					</td>

					<!-- Load schedule button -->
					<td class="button-cell schedule-manage">
						<button class="cell btn btn-sm btn-warning"
							data-bind="click: function() {
								$root.loadSchedule($data, $index);}" >
							Load Schedule
						</button>
					</td>

					<!-- Remove schedule button -->
					<td class="button-cell schedule-manage">
						<button class="cell btn btn-sm btn-danger"
							data-bind="click: function() {
								$root.removeSchedule($data, $index);}" >
							Remove Schedule
						</button>
					</td>
				</tr>

			</tfoot>
		</table>
		<hr data-bind="visible: ($root.schedules().length > 1); " />
	</section>

	<div class="container">
		<!-- Button to add new schedule -->
		<button data-bind="click: $root.addSchedule" class="button-schedule">
			+ Add New Schedule
		</button>
	</div>

	<script src="js/jquery-3.1.1.min.js"></script>
	<script src="js/knockout-3.4.1.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<script src="js/app.js"></script>
</body>

</html>